#### General
node_name   = "consul_{{ node_id }}"
client_addr = "0.0.0.0"
server      = false

#### Connection
ports {
  # only allow https
  http  = -1
  https = 8501
  grpc  = 8502
}

# join the server nodes as famileeeeeee
retry_join = [
{% for host in groups['servers'] %}
{% if hostvars[host]['ansible_host'] is defined %}
  {{ hostvars[host]['ansible_host'] }},
{% else %}
  {{ host }},
{% endif %}
{% endfor %}
]

#### Security
encrypt = "{{ consul_gossip_encrypt_key }}"

tls {
  defaults {
    key_file        = "{{ consul_certs_dir }}/consul_client_tls_key.pem"
    cert_file       = "{{ consul_certs_dir }}/consul_client_tls_cert.pem"
    ca_file         = "{{ consul_certs_dir }}/consul_ca_cert.pem"
    verify_incoming = true
    verify_outgoing = true
  }

  internal_rpc {
    verify_server_hostname = true
  }
}

acl {
  enabled                  = true
  default_policy           = "deny"
  enable_token_persistence = true

  tokens {
    default = "{{ consul_acl_client_token }}"
  }
}
